<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>è½åŠ›å°æˆ°éŠæˆ²</title>

<style>
:root{
  --border-black:#000;
  --pop-blue:#3b82f6;
  --pop-green:#22c55e;
  --pop-red:#ef4444;
  --pop-amber:#f59e0b;
  --pop-purple:#a855f7;
  --pop-orange:#f97316;
}
*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
body{
  margin:0;
  height:100vh;
  overflow:hidden;
  font-family:"PingFang TC","Microsoft JhengHei",sans-serif;
  background:linear-gradient(135deg,#FFD200 0%,#F7971E 100%);
}
.app{ height:100%; padding:15px; display:flex; flex-direction:column; gap:15px; }
.comic-box{
  background:#fff;
  border:4px solid var(--border-black);
  box-shadow:6px 6px 0 #000;
  border-radius:15px;
}
.topbar{ display:flex; gap:12px; padding:12px; align-items:center; flex-wrap:wrap; }
.topbar-logo{ height:80px; width:auto; object-fit:contain; display:block; }
@media (max-width:600px){ .topbar-logo{ height:60px; } }

.question-zone{
  flex:1; min-width:260px; height:84px;
  display:flex; align-items:center; justify-content:center;
  background:#f8fafc;
  border:4px dashed var(--border-black);
  border-radius:12px;
  cursor:pointer;
  position:relative;
  user-select:none;
}
.word-text{ font-size:42px; font-weight:900; color:#000; }
.listen-hint{ font-size:26px; color:#475569; font-weight:900; }

.comic-btn{
  background:#fff;
  border:3px solid #000;
  box-shadow:4px 4px 0 #000;
  border-radius:10px;
  padding:10px 16px;
  font-weight:900;
  font-size:18px;
  cursor:pointer;
  user-select:none;
}
.comic-btn:active{ transform:translate(2px,2px); box-shadow:0 0 0 #000; }

.pill{
  display:flex; align-items:center; gap:8px;
  padding:8px 10px;
  border:3px solid #000;
  border-radius:999px;
  background:#fff;
  box-shadow:4px 4px 0 #000;
}
.pill label{ font-weight:900; font-size:16px; white-space:nowrap; }
.pill select{
  font-size:14px;
  font-weight:900;
  border:2px solid #000;
  border-radius:10px;
  padding:6px 8px;
  outline:none;
  max-width: 320px;
}

.notice{
  display:none;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border:2px solid #000;
  border-radius:12px;
  background:#fff;
  box-shadow:3px 3px 0 #000;
  font-weight:900;
  font-size:14px;
  color:#111827;
}

.battle-ground{
  flex:1; min-height:0;
  display:grid; gap:15px;
  grid-template-columns: repeat(var(--cols, 3), 1fr);
}
.team-container{ display:flex; flex-direction:column; overflow:hidden; min-height:0; }
.team-info{
  padding:12px;
  border-bottom:4px solid #000;
  display:flex; justify-content:space-between; align-items:center;
  font-size:22px; font-weight:900;
  gap:8px; flex-wrap:wrap;
}
.score-tag{
  background:#000; color:#fff;
  padding:4px 12px; border-radius:999px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
  font-size:18px;
}

.options-list{
  flex:1; min-height:0;
  padding:12px;
  display:flex; flex-direction:column; gap:10px;
  overflow:auto;
}
.option-item{
  background:#fff;
  border:3px solid #000;
  border-radius:12px;
  padding:12px 10px;
  cursor:pointer;
  transition:0.08s;
  display:flex; align-items:center; justify-content:center;
  user-select:none;
  position:relative;
}
.option-item:hover{ transform:scale(1.02); }
.option-word{
  font-size:26px;
  font-weight:900;
  letter-spacing:0.3px;
  word-break: break-word;
  text-align:center;
  z-index:1;
}

.thumb-emoji{
  position:absolute; right:15px;
  font-size:45px; line-height:1;
  z-index:2;
  filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.3));
  animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}
@keyframes popIn{
  0%{ transform:scale(0) rotate(-45deg); opacity:0; }
  60%{ transform:scale(1.4) rotate(10deg); opacity:1; }
  100%{ transform:scale(1) rotate(0deg); opacity:1; }
}

.correct{ background:var(--pop-green)!important; color:#fff!important; border-color:#14532d!important; }
.wrong{
  background:var(--pop-red)!important; color:#fff!important;
  animation:shake .25s; opacity:.6; pointer-events:none;
}
.reveal-correct{
  border-color:var(--pop-amber)!important;
  box-shadow:0 0 0 4px rgba(245,158,11,.35)!important;
}
.locked{ opacity:.6; filter:grayscale(.1); pointer-events:none; }
.lock-badge{
  font-size:14px; font-weight:900;
  padding:4px 8px;
  border:2px solid #000;
  border-radius:999px;
  background:#fff;
  white-space:nowrap;
}
@keyframes shake{
  0%,100%{ transform:translateX(0); }
  25%{ transform:translateX(-6px); }
  75%{ transform:translateX(6px); }
}

.overlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  justify-content:center; align-items:center;
  z-index:50;
}
.modal{ width:min(580px, calc(100vw - 30px)); padding:22px; }
.modal h2{ margin:0 0 10px 0; }
.modal .row{
  display:flex; gap:10px; align-items:center; flex-wrap:wrap;
  margin:10px 0 12px;
}
.modal textarea{
  width:100%; height:170px;
  font-size:16px; padding:10px;
  border:3px solid #000; border-radius:10px;
  outline:none; resize:both;
}
.mini{
  font-weight:900; font-size:14px;
  color:#111827; background:#fff;
  border:2px solid #000; border-radius:10px;
  padding:6px 10px;
}
.podium{ display:flex; flex-direction:column; gap:10px; margin-top:10px; max-height:40vh; overflow-y:auto; }
.podium-item{
  border:3px solid #000; border-radius:14px;
  box-shadow:4px 4px 0 #000;
  padding:14px 16px;
  font-weight:900; font-size:22px;
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; flex-wrap:wrap;
}
.podium-left{ display:flex; gap:10px; align-items:center; }
.badge{
  display:inline-flex; align-items:center; justify-content:center;
  width:44px; height:44px;
  border:3px solid #000;
  border-radius:12px;
  background:#fff;
  font-size:22px;
}
.score-big{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
  font-size:22px;
  background:#000; color:#fff;
  padding:6px 12px;
  border-radius:999px;
}
.all-scores{ margin-top:12px; font-weight:900; font-size:14px; color:#334155; line-height:1.6; }

@media (max-width:900px){
  .battle-ground{ grid-template-columns:1fr!important; overflow:auto; }
  body{ overflow:auto; }
  .option-word{ font-size:30px; }
}
</style>
</head>

<body>
<div class="app">

  <div class="comic-box topbar">
    <img src="image_0.png" alt="KEAT Logo" class="topbar-logo">

    <div class="question-zone" id="btnSpeak" title="æ’­æ”¾ç™¼éŸ³">
      <div id="displayArea" class="listen-hint">æ’­æ”¾ç™¼éŸ³</div>
      <button id="btnEye" aria-label="toggle word"
        style="position:absolute; right:10px; top:10px; border:2px solid #000; border-radius:10px; background:#fff; font-weight:900; padding:6px 10px; cursor:pointer;">
        é¡¯ç¤º/éš±è—
      </button>
    </div>

    <div class="pill" title="é¸æ“‡å°æˆ°äººæ•¸/éšŠæ•¸">
      <label for="teamSelect">å°æˆ°</label>
      <select id="teamSelect">
        <option value="1">1 äºº</option>
        <option value="2">2 äºº</option>
        <option value="3" selected>3 äºº</option>
        <option value="4">4 äºº</option>
        <option value="5">5 äºº</option>
      </select>
    </div>

    <div class="pill" title="è¨­å®šå›æ•¸ï¼ˆæ¯å±€é¡Œæ•¸ï¼‰">
      <label for="roundSelect">å›æ•¸</label>
      <select id="roundSelect"></select>
    </div>

    <div class="pill" title="è‡ªå‹•ä¸‹ä¸€é¡Œæ¢ä»¶">
      <label for="autoSelect">è‡ªå‹•</label>
      <select id="autoSelect">
        <option value="off">é—œé–‰</option>
        <option value="correct">ç­”å°å°±ä¸‹ä¸€é¡Œ</option>
        <option value="all" selected>å…¨å“¡ç­”å°æ›ä¸‹ä¸€é¡Œ</option>
      </select>
    </div>

    <div id="ttsNotice" class="notice" aria-live="polite"></div>

    <div id="roundText" class="mini" style="min-width:140px; text-align:center;">Round 1 / 4</div>

    <div style="display:flex; gap:10px;">
      <button class="comic-btn" id="btnNext" style="background:var(--pop-green);">ä¸‹ä¸€é¡Œ</button>
      <button class="comic-btn" id="btnConfig">é¡Œåº«</button>
    </div>
  </div>

  <div class="battle-ground" id="battleGround"></div>
</div>

<div class="overlay" id="configOverlay">
  <div class="comic-box modal">
    <h2>é¡Œåº«è¨­å®š</h2>

    <div class="row">
      <div class="mini" id="bankCount">ç›®å‰é¡Œåº«ï¼š0</div>
      <button class="comic-btn" id="btnClear" style="background:#fff;">æ¸…ç©ºé¡Œåº«</button>
    </div>

    <textarea id="wordInput" placeholder="è²¼ä¸Šå–®å­—æˆ–ç‰‡èªï¼ˆæ”¯æ´ç©ºç™½ï¼‰&#10;ä¸€è¡Œä¸€é¡Œ æˆ– ç”¨é€—è™Ÿåˆ†éš”&#10;ä¾‹å¦‚ï¼š&#10;ice cream&#10;take off, look forward to, Apple"></textarea>

    <div style="display:flex; gap:10px; margin-top:12px;">
      <button class="comic-btn" id="btnApply" style="flex:1; background:var(--pop-blue); color:#fff;">å¥—ç”¨ï¼ˆè¦†è“‹èˆŠé¡Œåº«ï¼‰</button>
      <button class="comic-btn" id="btnCancel" style="flex:1;">é—œé–‰</button>
    </div>

    <div style="margin-top:10px; font-size:14px; font-weight:900; color:#334155;">
      è¦å‰‡ï¼šç­”å°è€…ä¾åºç²å¾— +10ã€+8ã€+6ã€+4ã€+2 <br>
      <span style="color:#22c55e;">é¸éŒ¯ä¸æ‰£åˆ†ï¼Œä¿®æ­£å¾Œé¸å°ä¾ç„¶æœ‰åˆ†ï¼</span>
    </div>
  </div>
</div>

<div class="overlay" id="resultOverlay">
  <div class="comic-box modal">
    <h2 style="font-size:28px;">ğŸ‰ æ¯”è³½çµæŸï¼æ’è¡Œæ¦œ</h2>
    <div id="podium" class="podium"></div>
    <div id="allScores" class="all-scores"></div>

    <div style="display:flex; gap:10px; margin-top:14px;">
      <button class="comic-btn" id="btnRestart" style="flex:1; background:var(--pop-green);">å†ä¾†ä¸€å±€ï¼ˆåˆ†æ•¸æ­¸é›¶ï¼‰</button>
      <button class="comic-btn" id="btnResultClose" style="flex:1;">é—œé–‰</button>
    </div>
  </div>
</div>

<script>
/* ================== åƒæ•¸ ================== */
let TOTAL_QUESTIONS = 4;
const OPTIONS_PER_QUESTION = 4;
const RACE_POINTS = [10, 8, 6, 4, 2];
const AUTO_DELAY_MS = 1500;

/* ================== é¡Œåº« ================== */
const DEFAULT_WORDS = ["Apple","Banana","Cat","Dog","Car","Fish","Sun","Moon","Book","Bird","Lion","Milk","Tree","Water","Fire"];
let MASTER_WORDS = [...DEFAULT_WORDS];

/* ================== ç‹€æ…‹ ================== */
let teamCount = 3;
let teamScores = [0,0,0,0,0];
let gameBank = [];
let currentIdx = 0;
let isShowWord = false;
let gameEnded = false;

let correctRank = 0;
let answeredTeams = new Set();
let missedTeams = new Set();

let autoMode = "all";
let autoTimer = null;
let questionFinalized = false;

/* ================== âœ… FREE TTS (speechSynthesis) ================== */
let cachedVoices = [];

let noticeTimer = null;
function showNotice(msg){
  const el = document.getElementById("ttsNotice");
  if(!el) return;
  el.textContent = msg;
  el.style.display = "inline-flex";
  clearTimeout(noticeTimer);
  noticeTimer = setTimeout(()=>{ el.style.display="none"; }, 2600);
}

function refreshVoices(){
  try{
    cachedVoices = speechSynthesis.getVoices() || [];
  }catch(e){
    cachedVoices = [];
  }
}

function pickVoice(){
  // è‡ªå‹•ï¼šå„ªå…ˆ en-USï¼Œè‹¥æ²’æœ‰å‰‡ç”¨ä»»ä½•è‹±æ–‡
  const voices = cachedVoices || [];
  if(voices.length === 0) return null;

  const english = voices.filter(v => ((v.lang||"").toLowerCase().startsWith("en")));
  if(english.length === 0) return null;

  const enus = english.filter(v => ((v.lang||"").toLowerCase() === "en-us"));
  return (enus[0] || english[0] || null);
}

function speak(text){
  if(!window.speechSynthesis){ showNotice("âš ï¸ æ­¤ç€è¦½å™¨ä¸æ”¯æ´å…è²»TTS"); return; }
  window.speechSynthesis.cancel();

  const target = (text ?? gameBank[currentIdx]?.answer ?? "").toString().trim();
  if(!target) return;

  if((cachedVoices||[]).length === 0) refreshVoices();

  const u = new SpeechSynthesisUtterance(target);
  u.lang = "en-US";   // ç›¡é‡ç¾å¼
  // ä¸é¡¯ç¤º Rate UIï¼šç¶­æŒç³»çµ±é è¨­ rate/pitch
  // u.rate = 1.0;
  // u.pitch = 1.0;

  const v = pickVoice();
  if(v) u.voice = v;

  speechSynthesis.speak(u);
}

/* ================== å·¥å…· ================== */
function uniq(arr){
  const seen = new Set();
  const out = [];
  for(const x of arr){
    const t = String(x).trim();
    if(!t) continue;
    const key = t.toLowerCase();
    if(seen.has(key)) continue;
    seen.add(key);
    out.push(t);
  }
  return out;
}
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}
function setCols(n){
  document.getElementById("battleGround").style.setProperty("--cols", String(n));
}
function updateBankCount(){
  document.getElementById("bankCount").textContent = `ç›®å‰é¡Œåº«ï¼š${MASTER_WORDS.length}`;
}
function updateRoundText(){
  const total = gameBank.length || TOTAL_QUESTIONS;
  document.getElementById("roundText").textContent = `Round ${Math.min(currentIdx+1,total)} / ${total}`;
}
function lockTeam(teamIdx){
  const list = document.getElementById(`list-${teamIdx}`);
  if(!list) return;
  list.classList.add("locked");
  const header = list.closest(".team-container")?.querySelector(".team-info");
  if(header && !header.querySelector(`[data-lock="${teamIdx}"]`)){
    const badge = document.createElement("span");
    badge.className = "lock-badge";
    badge.setAttribute("data-lock", String(teamIdx));
    badge.textContent = "å®Œæˆ";
    header.appendChild(badge);
  }
}
function clearLocks(){
  for(let t=0;t<teamCount;t++){
    const list = document.getElementById(`list-${t}`);
    if(list) list.classList.remove("locked");
    const header = list?.closest(".team-container")?.querySelector(".team-info");
    const badge = header?.querySelector(`[data-lock="${t}"]`);
    if(badge) badge.remove();
  }
}
function clearAutoTimer(){
  if(autoTimer){ clearTimeout(autoTimer); autoTimer = null; }
}

/* ================== å»ºé¡Œ ================== */
function buildGameBank(){
  MASTER_WORDS = uniq(MASTER_WORDS);
  if(MASTER_WORDS.length < OPTIONS_PER_QUESTION){
    alert(`é¡Œåº«ä¸è¶³ ${OPTIONS_PER_QUESTION} å€‹å–®å­—/ç‰‡èªï¼Œè«‹åœ¨é¡Œåº«åŠ å…¥æ›´å¤šã€‚`);
    return false;
  }
  const pool = shuffle([...MASTER_WORDS]);
  const answers = [];
  for(let i=0;i<TOTAL_QUESTIONS;i++){
    answers.push(pool[i % pool.length]);
  }
  shuffle(answers);

  gameBank = answers.map(ans=>{
    const others = MASTER_WORDS.filter(w => w.toLowerCase() !== ans.toLowerCase());
    shuffle(others);
    const options = shuffle([ans, ...others.slice(0, OPTIONS_PER_QUESTION-1)]);
    return { answer: ans, options };
  });

  shuffle(gameBank);
  return true;
}

/* ================== é¡¯ç¤ºç­”æ¡ˆ ================== */
function revealCorrectAnswer(){
  const q = gameBank[currentIdx];
  if(!q) return;
  for(let t=0;t<teamCount;t++){
    const list = document.getElementById(`list-${t}`);
    if(!list) continue;
    const items = Array.from(list.querySelectorAll(".option-item"));
    for(const it of items){
      const txt = (it.querySelector('.option-word')?.textContent || "").trim();
      if(txt.toLowerCase() === q.answer.toLowerCase()){
        it.classList.add("reveal-correct");
      }
    }
  }
}

function finalizeQuestionAndMaybeAutoNext(){
  if(questionFinalized) return;
  questionFinalized = true;

  revealCorrectAnswer();

  if(autoMode !== "off"){
    clearAutoTimer();
    autoTimer = setTimeout(()=> nextQuestion(), AUTO_DELAY_MS);
  }
}

function nextQuestion(){
  if(gameEnded) return;
  clearAutoTimer();
  currentIdx++;
  isShowWord = false;
  updateUI();
}

/* ================== çµæœæ’è¡Œ ================== */
function showResults(){
  const overlay = document.getElementById("resultOverlay");
  const podium = document.getElementById("podium");
  const allScores = document.getElementById("allScores");

  const standings = [];
  for(let i=0;i<teamCount;i++){
    standings.push({ team: i+1, score: teamScores[i] || 0 });
  }
  standings.sort((a,b)=> (b.score - a.score) || (a.team - b.team));

  const ranks = [];
  for(let i=0;i<standings.length;i++){
    if(i===0){ ranks[i]=1; continue; }
    ranks[i] = (standings[i].score === standings[i-1].score) ? ranks[i-1] : (i+1);
  }

  const medalByRank = {1:"ğŸ¥‡",2:"ğŸ¥ˆ",3:"ğŸ¥‰",4:"ğŸ–ï¸",5:"ğŸ–ï¸"};
  const labelByRank = {1:"ç¬¬ä¸€å",2:"ç¬¬äºŒå",3:"ç¬¬ä¸‰å",4:"ç¬¬å››å",5:"ç¬¬äº”å"};

  podium.innerHTML = "";
  for(let i=0;i<standings.length;i++){
    const r = ranks[i];
    const s = standings[i];
    const tied = (i>0 && ranks[i]===ranks[i-1] && standings[i].score===standings[i-1].score)
               || standings.some((x, idx)=> idx!==i && ranks[idx]===r && x.score===s.score);
    const label = (labelByRank[r] || `ç¬¬${r}å`) + (tied ? " (ä¸¦åˆ—)" : "");

    const item = document.createElement("div");
    item.className = "podium-item";

    let bgColor = "#f8fafc";
    if(r===1) bgColor = "#fff7ed";
    else if(r===2) bgColor = "#eff6ff";
    else if(r===3) bgColor = "#f0fdf4";

    item.style.background = bgColor;

    item.innerHTML = `
      <div class="podium-left">
        <span class="badge">${medalByRank[r] || "ğŸ…"}</span>
        <div>${label}ï¼šTEAM ${s.team}</div>
      </div>
      <div class="score-big">${s.score} åˆ†</div>
    `;
    podium.appendChild(item);
  }

  allScores.innerHTML = "";
  overlay.style.display = "flex";
}

function initGame(){
  if(!buildGameBank()) return;
  currentIdx = 0;
  isShowWord = false;
  gameEnded = false;
  renderBattleGround();
  updateUI();
  updateBankCount();
}

function renderBattleGround(){
  const bg = document.getElementById("battleGround");
  bg.innerHTML = "";
  setCols(teamCount);

  const teamBg = ["#fff5f5","#f0f9ff","#f0fdf4","#fdf4ff","#fff7ed"];
  const teamColor = ["#ef4444","#3b82f6","#22c55e","#a855f7","#f97316"];

  for(let i=0;i<teamCount;i++){
    const div = document.createElement("div");
    div.className = "comic-box team-container";
    div.style.background = teamBg[i] || "#fff";
    div.innerHTML = `
      <div class="team-info" style="color:${teamColor[i] || '#000'}">
        <span>TEAM ${i+1}</span>
        <span class="score-tag" id="score-${i}">${teamScores[i] || 0}</span>
      </div>
      <div class="options-list" id="list-${i}"></div>
    `;
    bg.appendChild(div);
  }
}

function updateUI(){
  if(gameEnded){ showResults(); return; }
  if(currentIdx >= gameBank.length){ gameEnded = true; showResults(); return; }

  clearAutoTimer();
  questionFinalized = false;

  answeredTeams = new Set();
  missedTeams = new Set();
  correctRank = 0;
  clearLocks();

  const q = gameBank[currentIdx];
  const display = document.getElementById("displayArea");
  updateRoundText();

  if(isShowWord){
    display.className = "word-text";
    display.textContent = q.answer;
  }else{
    display.className = "listen-hint";
    display.textContent = "æ’­æ”¾ç™¼éŸ³";
  }

  for(let t=0;t<teamCount;t++){
    const list = document.getElementById(`list-${t}`);
    if(!list) continue;
    list.innerHTML = "";
    const opts = shuffle([...q.options]);
    for(const opt of opts){
      const item = document.createElement("div");
      item.className = "option-item";
      item.innerHTML = `<div class="option-word">${opt}</div>`;
      item.onclick = () => checkAnswer(t, opt, q.answer, item);
      list.appendChild(item);
    }
  }
  speak();
}

/* ================== ä½œç­”é‚è¼¯ ================== */
function checkAnswer(teamIdx, pick, ans, el){
  if(gameEnded) return;
  if(answeredTeams.has(teamIdx)) return;
  if(el.classList.contains("wrong") || el.classList.contains("correct")) return;

  const isCorrect = (pick.toLowerCase() === ans.toLowerCase());

  if(isCorrect){
    el.classList.add("correct");

    const emojiSpan = document.createElement("span");
    emojiSpan.className = "thumb-emoji";
    emojiSpan.textContent = "ğŸ‘";
    el.appendChild(emojiSpan);

    const pts = RACE_POINTS[correctRank] ?? 2;
    correctRank++;

    teamScores[teamIdx] = (teamScores[teamIdx] || 0) + pts;
    document.getElementById(`score-${teamIdx}`).textContent = teamScores[teamIdx];

    speak(ans);

    answeredTeams.add(teamIdx);
    lockTeam(teamIdx);

    if(autoMode === "correct"){
      finalizeQuestionAndMaybeAutoNext();
    }
  }else{
    el.classList.add("wrong");
    missedTeams.add(teamIdx);
  }

  if(autoMode === "all" && answeredTeams.size >= teamCount){
    finalizeQuestionAndMaybeAutoNext();
  }
}

/* ================== äº‹ä»¶ ================== */
document.getElementById("btnSpeak").onclick = (e)=>{
  if(e.target.id !== "btnEye") speak();
};
document.getElementById("btnEye").onclick = (e)=>{
  e.stopPropagation();
  isShowWord = !isShowWord;
  updateUI();
};
document.getElementById("btnNext").onclick = ()=> nextQuestion();

document.getElementById("teamSelect").addEventListener("change", (e)=>{
  teamCount = Math.max(1, Math.min(5, parseInt(e.target.value,10) || 3));
  renderBattleGround();
  updateUI();
});

const roundSelect = document.getElementById("roundSelect");
for(let i=4;i<=20;i++){
  const opt = document.createElement("option");
  opt.value = String(i);
  opt.textContent = `${i} å›`;
  roundSelect.appendChild(opt);
}
roundSelect.value = "4";
roundSelect.addEventListener("change", (e)=>{
  TOTAL_QUESTIONS = Math.max(4, Math.min(20, parseInt(e.target.value,10) || 4));
  initGame();
});

document.getElementById("autoSelect").addEventListener("change", (e)=>{
  autoMode = e.target.value || "all";
  clearAutoTimer();
});

/* é¡Œåº«è¦–çª— */
const configOverlay = document.getElementById("configOverlay");
document.getElementById("btnConfig").onclick = ()=>{
  document.getElementById("wordInput").value = MASTER_WORDS.join("\n");
  updateBankCount();
  configOverlay.style.display = "flex";
};
document.getElementById("btnCancel").onclick = ()=>{ configOverlay.style.display = "none"; };
document.getElementById("btnClear").onclick = ()=>{
  MASTER_WORDS = [];
  updateBankCount();
  document.getElementById("wordInput").value = "";
};
document.getElementById("btnApply").onclick = ()=>{
  const raw = document.getElementById("wordInput").value || "";
  const items = raw.split(/\n|,/).map(s=>s.trim()).filter(Boolean);
  const clean = uniq(items);

  if(clean.length < OPTIONS_PER_QUESTION){
    alert(`è«‹è‡³å°‘è¼¸å…¥ ${OPTIONS_PER_QUESTION} å€‹å–®å­—/ç‰‡èª`);
    return;
  }
  MASTER_WORDS = clean;
  teamScores = [0,0,0,0,0];
  configOverlay.style.display = "none";
  initGame();
};

const resultOverlay = document.getElementById("resultOverlay");
document.getElementById("btnResultClose").onclick = ()=> resultOverlay.style.display = "none";
document.getElementById("btnRestart").onclick = ()=>{
  resultOverlay.style.display = "none";
  teamScores = [0,0,0,0,0];
  initGame();
};

/* âœ… voices load */
if("speechSynthesis" in window){
  refreshVoices();
  window.speechSynthesis.onvoiceschanged = () => refreshVoices();
}else{
  showNotice("âš ï¸ æ­¤ç€è¦½å™¨ä¸æ”¯æ´å…è²»TTSï¼ˆspeechSynthesisï¼‰");
}

updateBankCount();
initGame();
</script>

<script>
/* ====== åªåœç”¨å³éµï¼ˆä¸åµæ¸¬ DevToolsï¼‰ ====== */
document.addEventListener('contextmenu', (e) => { e.preventDefault(); return false; });
</script>

</body>
</html>
